<?xml version="1.0"?>
<project name="patch">

  <taskdef resource="net/sf/antcontrib/antcontrib.properties">
    <classpath>
      <pathelement location="${antlib}/ant-contrib.jar"/>
    </classpath>
  </taskdef>

  <target name="patch" depends="scm">
    <foreach param="patchfile" target="do-patch">
      <path>
        <fileset dir="${patch}"/>
      </path>
    </foreach>
    <delete verbose="true">
      <fileset dir="${guice}/src" includes="**/*.java">
        <size value="0"/>
      </fileset>
    </delete>
  </target>

  <target name="do-patch" depends="check-patch,apply-patch"/>

  <target name="check-patch">
    <basename property="name" file="${patchfile}" suffix="txt"/>
    <available file="${name}.java" type="file" property="already.applied">
      <filepath>
        <dirset dir="${guice}"/>
      </filepath>
    </available>
  </target>

  <target name="apply-patch" unless="already.applied">
    <patch patchfile="${patchfile}" dir="${guice}" strip="0"/>
  </target>

</project>
