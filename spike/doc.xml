<?xml version="1.0"?>
<project name="doc">

  <taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask"
      classpath="${antlib}/jaxen.jar;${antlib}/pmd.jar;${asm.jar}"/>

  <target name="pmd">
    <mkdir dir="${doc}/coverage"/>
    <pmd rulesetfiles="pmd.xml" shortFilenames="true">
      <formatter type="html" toFile="${doc}/coverage/pmd.html" linkPrefix="" linePrefix="src-"/>
      <fileset dir="${src}" includes="**/*.java"/>
      <auxclasspath>
        <pathelement location="${build}/classes"/>
      </auxclasspath>
    </pmd>
  </target>

  <target name="doc" depends="check.doc,make.doc"/>

  <target name="check.doc">
    <available file="${doc}/javadoc/index.html" property="have.doc"/>
  </target>

  <target name="make.doc" unless="have.doc">
    <mkdir dir="${doc}/javadoc"/>
    <javadoc destdir="${doc}/javadoc" classpath="${build.cp}" sourcepath="${src}"
        packagenames="${module},${module}.builders,${module}.util"
        use="true" author="false" windowtitle="${title}">
      <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
      <link href="http://google-guice.googlecode.com/svn/trunk/javadoc/"/>
      <link href="http://aopalliance.sourceforge.net/doc/"/>
      <link href="http://www2.osgi.org/javadoc/r4/"/>
    </javadoc>
  </target>

</project>
